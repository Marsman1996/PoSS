<!-- 这篇文章主要记录我复现和分析 CVE-2015-3878 的过程. -->
## CVE-2015-3878
**Test Environment**: Google Nexus 5, Android 5.0-API21(in GENYMOTION)

**漏洞原理**: 
Android 5.0新增屏幕录制API `MediaProjection`. 它会在在每次应用发起录制请求时向用户进行询问, 而不是在应用安装时获取特殊权限. 
但是在Android 6.0之前系统向用户显示的询问窗口并没有对发起屏幕录制请求应用的应用名作出限制. 一个足够长的应用名字会使 "将开始截取您的屏幕上的所有内容" 这段提示语将不再显示在询问窗口中的可视范围内. 如果攻击者为恶意应用构造一个看起来合理的长应用名, 就可以将该提示框变成一个UI陷阱, 使其失去原有的 "录屏授权" 提示功能, 并使恶意程序在用户不知情的情况下录制用户手机屏幕.

**漏洞利用**: 
修改应用名为

```
<string name="app_name">建设银行客户端注意事项:\n1、不要在公共场所使用网上银行，防止他人偷看您的密码。\n2、不要在网吧、图书馆等公用网络上使用网上银行，防止他人安装监测程序或木马程序窃取账号和密码。\n3、每次使用网上银行后，及时退出。\n4、在其他渠道（如ATM取款、自助终端登录）进行交易时，注意密码输入的保护措施，防止他人通过录像等方式窃取到您的账号和密码。\n5、切勿向他人透露您的用户名、密码或任何个人身份识别资料。\n6、如果您的个人资料有任何更改（例如，联系方式、地址等有变动），请及时通过银行系统修改相关资料。\n7、定期查看您的交易，核对对账单。\n8、遇到任何怀疑或问题，请及时联系我行“95555-全国统一客服电话”。点击“立即开始”按钮继续执行\t\t\t\t\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\naaa</string>
```

效果如图所示
<div align="center">
    <img src="cve-2015-3878\ori_name.png" width="200">
    <img src="cve-2015-3878\mal_name.png" width="200">
</div>
<center>图1 a:短应用名下提示框显示 b:长应用名下提示框显示</center>

**Download**: [录屏APK下载](https://github.com/Marsman1996/PoSS/releases/tag/0.0)

**REFERENCE**: 
[CVE界面](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-3878) [Android安全通告](https://source.android.com/security/bulletin/2015-10-01) [360发布地址](https://www.freebuf.com/vuls/81905.html)